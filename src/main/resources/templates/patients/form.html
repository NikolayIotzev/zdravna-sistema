<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('Пациент - Медицинско досие')}"></head>
<body class="d-flex flex-column min-vh-100">
<nav th:replace="~{fragments/layout :: navbar}"></nav>

<main class="flex-grow-1">
    <div class="container mt-4">
        <h2>
            <i class="bi bi-person"></i>
            <span th:text="${patient.id != null ? 'Редактиране на пациент' : 'Нов пациент'}"></span>
        </h2>

        <div class="card mt-4">
            <div class="card-body">
                <form th:action="${patient.id != null ? '/patients/edit/' + patient.id : '/patients/new'}"
                      method="post" th:object="${patient}">

                    <div th:if="${patient.id == null}" class="mb-3">
                        <label for="username" class="form-label">Потребителско име *</label>
                        <input type="text" class="form-control" id="username" th:field="*{username}"
                               th:required="${patient.id == null}"
                               minlength="3" maxlength="50" placeholder="patient_username">
                        <div class="form-text">Между 3 и 50 символа</div>
                    </div>

                    <div th:if="${patient.id == null}" class="mb-3">
                        <label for="password" class="form-label">Парола *</label>
                        <input type="password" class="form-control" id="password" th:field="*{password}"
                               th:required="${patient.id == null}"
                               minlength="6" maxlength="100" placeholder="******">
                        <div class="form-text">Минимум 6 символа</div>
                    </div>

                    <div class="mb-3">
                        <label for="name" class="form-label">Име *</label>
                        <input type="text" class="form-control" id="name" th:field="*{name}" required
                               minlength="2" maxlength="100" placeholder="Георги Иванов">
                    </div>

                    <div class="mb-3">
                        <label for="egn" class="form-label">ЕГН *</label>
                        <input type="text" class="form-control" id="egn" th:field="*{egn}" required
                               pattern="\d{10}" maxlength="10" placeholder="8501011234">
                        <div class="form-text">10 цифри</div>
                    </div>

                    <div class="mb-3">
                        <label for="gpId" class="form-label">Личен лекар</label>
                        <select class="form-select" id="gpId" th:field="*{gpId}">
                            <option value="">-- Без личен лекар --</option>
                            <option th:each="gp : ${gps}" th:value="${gp.id}" th:text="${gp.name}"></option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="lastInsurancePayment" class="form-label">Последно плащане на осигуровки</label>
                        <input type="date" class="form-control" id="lastInsurancePayment"
                               th:field="*{lastInsurancePayment}">
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-lg"></i> Запази
                        </button>
                        <a th:href="@{/patients}" class="btn btn-secondary">
                            <i class="bi bi-x-lg"></i> Отказ
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</main>

<div th:replace="~{fragments/layout :: scripts}"></div>
</body>
</html>
